> 2025-04-01
> 

---

# Study

---

# Problem Solving

---

# Project

## WCCG

### OAuth 관련

- 리팩토링
    - 회원 비회원 분기처리 구현했던걸 메서드 추출해서 좀더 보기 좋게 했다.
- 토큰 비활성화
    - 사실 깃허브가 주는 OAuth 액세스 토큰은 매번 새로 발급해주더라도. 예전것도 쓸수 있다고 한다. 하지만 우리 시스템에서는 가장 최신의것 하나로 관리하는게 좋겠지.
        - 나중에 유저가 Revoke 했을떄도, 유저는 db에 등록되어 있는데 토큰이 권한을 잃었을경우 새로 발급시켜주는 로직도 좀 넣어야 할듯 하네.
    - 토큰 발급시 기존 토큰들을 비활성화 시켜주는 로직은 그럭저럭 할만했다.

### JWT 관련

- 이제 JWT를 클라이언트에게 간단한 정보와 발급하게 했다.
- 다만, 이 JWT를 주는건 클라이언트가 요청해서 주는게 아니라 깃허브가 그냥 쏴주는거다. 그래서.
    - 현재는 지금처럼 테스트하고, 나중에는 **로그인 성공시 콜백을 프론트에게 줘서, 프론트가 그 코드를 받고, 나에게 코드를 통해 유저를 등록하게 해야한다.**
- JWT를 클라이언트에 발급하고 나면, 두번의 검사를 해야한다.
    - `JwtAuthenticationFilter` 가 요청헤더에서 JWT를 파싱한다.
    - 이후 `JwtProvider`  에게 메세지를 보내서 이 일들을 시킨다.
        - JWT를 줘서 이 JWT가 유효한지 검증한다.
        - JWT를 줘서  `id` 를 파싱하게 하여 받는다.
    - `JwtAuthenticationFilter` 가 이 id를 사용하는 유저가 유효한지(없지는 않은지, 비활성화 되어있지는 않은지) DB에서 조회하여 검사한다.
    - 모든 테스트를 통과했다면, 스프링 시큐리티의 `UsernamePasswordAuthenticationToken` 와 같은 객체로 감싼다.
    - `SecurityContextHolder` 에게 인등된 사용자임을 알린다.
    - `filterChain.doFilter(request, response)` : 다음 필터에게 연쇄 요청
- 유저 권한과 스프링 시큐리티 내의 권한… 조금더 생각해보고 코드 써야겠다. 머리가 조금 아프네.

---

# etc.

---
