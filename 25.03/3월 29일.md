> 2025-03-29
> 

---

# Study

## 아키텍처 또는 클린코드

### DTO에 대해.

- 모든 과정에서 DTO를 새로 만들어서 보내주는 것이 좋다.
    - 브라우저 ↔ 컨트롤러 ↔ 서비스 전부 다.
- 그럼 똑같은 내용을 계속해서 DTO만 다르게 해야한다는데… 결국 이렇게 하는게 유지보수에 좋다. 요구사항 변경 등으로 DTO가 바뀔떄 한번에 바뀌면 유지보수 지옥이 펼쳐질테니.
- 클린 아키텍처 책에서 "매핑하기 전략" 이란것이 있다고 한다. 추후 참고해보자.

## WebFlux

- 원래는 비동기 논블로킹 동작 프레임워크? 인것 같다만.
- 이번에는 `WebClient` 를 사용하기 위해 일부만 썼다.
    - 깃허브 외부 API에 HTTP 메시지를 보내게 해주는 쉽고? 간편한 방법

---

# Problem Solving

---

# Project

## WCCG

### OAuth 로그인 링크 제공

- github OAuth 앱 등록할때 받은 클라이언트 ID와 패스워드, 그리고 설정한 콜백 URL을 [`application.properties`](http://application.properties) 에 적어놓기.
- 그리고 `GithubOAuthProperties` 가 프로퍼티 파엘에게 이 값들을 주입받기.
    - `@ConfigurationProperties(prefix = "github")` 로 설정해주면 주입 받아진다.
- 그리고 컨트롤러 에서는 엔드포인트로 유저가 로그인 페이지를 보여달라고 요청하면, `OAuthService` 가 로그인 페이지 링크 DTO를 만들어서 보내준다.
- 서비스가 하는일은 별거 없다. 값을 주입받은 `GithubOAuthProperties` 의 값들로 URL을 만든 다음 컨트롤러에게 보내주기

### OAuth 로그인 성공 후 액세스 토큰, 유저 정보 저장

- 우선 로그인을 성공하면 주는 값은 “코드” 뿐이다.
    - `5f1e8f1fd5d` 이런 의미없는 값.
- 이 코드를 깃허브 외부 API 에 요청해서 액세스 토큰을 받아내야 했다.
    - `WebClient` 를 사용해야 했기 떄문에 `WebFlux` 의존성을 추가.
- 액세스 토큰을 받고 또다서 깃허브 외부 API 에 요청해서 유저 정보를 받아내야 했다.
- 흐름을 정리하면
    1. 로그인 성공했는데 코드만 덜렁 줬다.
    2. 그 코드를 가지고 액세스 토큰을 받아내야 한다.
    3. 웹클라이언트를 만들어서 거기서 깃허브 외부 API 에 요청해서 받아낸다.
    4. 액세스 토큰을 받았으면, 다시한번 이 액세스 토큰으로 외부 API에 요청해 유저 정보 받아오기
    5. 둘다 받았다! DB 에 저장한다!
- 어떻게든 해피케이스 위주로 구현은 완료했고. 트랜잭션이나 예외처리는 조금 나중에 손 봐주도록 하자.
- 생각보다 할만한데?

---

# etc.

---
